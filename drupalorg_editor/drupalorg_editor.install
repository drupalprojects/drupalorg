<?php

/**
 * @file
 * Install, update and uninstall functions for the drupalorg_editor module.
 */

/**
 * Implements hook_install().
 */
function drupalorg_editor_install() {
  $filename = 'entity_embed_file.png';
  $destination = 'public://drupalorg-editor';

  // Load the file's contents.
  $path = drupal_get_path('module', 'drupalorg_editor') . '/images/' . $filename;
  $data = file_get_contents($path);

  // Create a managed file.
  file_prepare_directory($destination, FILE_CREATE_DIRECTORY);
  $file = file_save_data($data, $destination . '/' . $filename, FILE_EXISTS_REPLACE);

  // Store the file's ID.
  variable_set('drupalorg_editor_entity_embed_icon_fid', $file->fid);
}

/**
 * Implements hook_uninstall().
 */
function drupalorg_editor_uninstall() {
  // Delete the Entity Embed file icon.
  $fid = variable_get('drupalorg_editor_entity_embed_icon_fid', FALSE);
  if ($fid) {
    $file = file_load($fid);

    if ($file) {
      file_delete($file);
    }
  }

  // Delete the folder the icon was stored in.
  $banner_folder = 'public://drupalorg-editor';
  file_unmanaged_delete_recursive($banner_folder);

  // Remove the storage variable.
  variable_del('drupalorg_editor_entity_embed_icon_fid');
}
